# CDM Bug Report: Spurious "Primary key change requires manual migration" comment

## Summary

When adding new entities to the schema, the migration generates an unrelated comment about a primary key change on an existing table that was not modified:

```sql
-- Primary key change requires manual migration: idx_users_0
```

This comment is confusing and incorrect - no primary key change was requested, and users may spend time investigating a non-existent issue.

## Real-world Example

In the actual migration (`0002.up.postgres.sql`), adding `Project`, `ProjectRepo`, `Daemon`, and `DaemonAuthRequest` entities generated this spurious comment:

```sql
-- Migration generated by CDM SQL Plugin
-- Dialect: PostgreSQL

-- Type alias added: ProjectSetupStatus

-- Primary key change requires manual migration: idx_users_0

CREATE TABLE "project_repos" (
  ...
);
```

The User table was not modified in this schema change. Only new entities were added.

## Root Cause

The migration diff algorithm appears to be incorrectly detecting a primary key change when:
1. The User entity's config section doesn't explicitly include the primary key index (it's inherited from `Entity`)
2. The previous schema JSON shows the primary key index was present

The diff may be comparing the inherited config vs. the explicit config differently between runs.

## Minimal Reproduction

### Files

**`public.cdm`**:
```cdm
import sqlType from "sql-types/postgres"

@sql

Entity {
  id: sqlType.UUID
  @sql {
    indexes: [
      { fields: ["id"], primary: true }
    ]
  }
}

Timestamped {
  created_at: sqlType.TimestampTZ {
    @sql { default: "NOW()" }
  }
}

TimestampedEntity extends Entity, Timestamped {
}

PublicUser extends TimestampedEntity {
  name?: string
}

// New entity to add
PublicProject extends TimestampedEntity {
  name: string
}
```

**`database.cdm`**:
```cdm
import sql from "sql-types/postgres"

extends "./public.cdm"

@sql {
  dialect: "postgresql",
  migrations_output: "./migrations",
  build_output: "./output"
}

-PublicUser
-Timestamped
-Entity
-TimestampedEntity
-PublicProject

User extends PublicUser {
  email?: sql.Varchar
}

// Adding a simple new entity - should not affect existing User table
Project extends PublicProject {
  owner_id: sql.UUID {
    @sql {
      references: { table: "users", column: "id", on_delete: "cascade" }
    }
  }
}
```

**`previous_schema.json`** - State before adding Project entity:

Note: The User entity in this previous schema does NOT have explicit `sql.indexes` in its config (it inherits from Entity), but when the migration compares schemas, it incorrectly detects a primary key change.

```json
{
  "models": {
    "User": {
      "name": "User",
      "parents": ["PublicUser"],
      "fields": [
        { "name": "id", ... },
        { "name": "created_at", ... },
        { "name": "name", ... },
        { "name": "email", ... }
      ],
      "config": {}
    }
  },
  "type_aliases": {}
}
```

### Steps to Reproduce

```bash
cd packages/schema/cdm-bug-repro/bugs/08-spurious-manual-migration-comment
mkdir -p .cdm
cp previous_schema.json .cdm/previous_schema_database.json
cdm migrate database.cdm --name add_project
cat migrations/add_project.up.postgres.sql
```

## Actual Output

```sql
-- Migration generated by CDM SQL Plugin
-- Dialect: PostgreSQL

-- Primary key change requires manual migration: idx_users_0

CREATE TABLE "projects" (
  "id" UUID NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "name" VARCHAR(255) NOT NULL,
  "owner_id" UUID NOT NULL REFERENCES "users"("id") ON DELETE CASCADE,
  PRIMARY KEY ("id")
);
```

## Expected Output

```sql
-- Migration generated by CDM SQL Plugin
-- Dialect: PostgreSQL

CREATE TABLE "projects" (
  "id" UUID NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "name" VARCHAR(255) NOT NULL,
  "owner_id" UUID NOT NULL REFERENCES "users"("id") ON DELETE CASCADE,
  PRIMARY KEY ("id")
);
```

No comment about primary key changes should be generated since:
1. The User table was not modified
2. No primary key was changed on any table
3. The comment creates confusion and suggests manual intervention is needed when it isn't

## Notes

- This appears to be a false positive in the schema diff algorithm
- The comment references `idx_users_0` which is the internal name CDM generates for the primary key index
- Spurious warnings can erode user trust in the migration system
- The migration should only include comments about changes that actually need manual attention
